
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>æ™‚å ±éŸ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (é€£ç¶šå†ç”Ÿãƒ»éŸ³è‰²é¸æŠ)</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <style>
       /* ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š */
       :root {
           font-family: 'Inter', sans-serif;
       }
       /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
       .signal-display {
           font-size: 6rem;
           font-weight: 700;
           transition: color 0.1s;
           margin-bottom: 0.5rem;
       }
       .container-box {
           box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
       }
       /* LINEãƒœã‚¿ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
       .line-share-button {
           display: flex;
           align-items: center;
           justify-content: center;
           gap: 8px;
           background-color: #00C300; /* LINEã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ */
           color: white;
           font-weight: bold;
           text-decoration: none;
           padding: 12px 20px;
           border-radius: 8px;
           transition: background-color 0.3s;
       }
       .line-share-button:hover {
           background-color: #00A800;
       }
   </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

   <div class="w-full max-w-lg bg-white p-6 md:p-10 rounded-xl container-box text-center">
       <h1 class="text-3xl font-bold text-gray-800 mb-4">é€£ç¶šæ™‚å ±éŸ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
       <p class="text-gray-600 mb-6">éŸ³è‰²ã‚’é¸æŠã—ã€5ç§’æ¯ã®ã€Œãƒ”ãƒƒãƒ»ãƒ”ãƒƒãƒ»ãƒãƒ¼ãƒ³ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é€£ç¶šå†ç”Ÿã—ã¾ã™ã€‚</p>

       <!-- è¨­å®šãƒ‘ãƒãƒ« -->
       <div class="mb-6 p-4 bg-gray-100 rounded-lg shadow-inner">
           <h2 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">æ™‚å ±éŸ³ å‘¨æ³¢æ•°è¨­å®š (Hz)</h2>
           
           <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ -->
           <div class="mb-4">
               <label for="presetSelector" class="block text-sm font-medium text-gray-700 text-left mb-1">éŸ³è‰²ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’é¸ã¶</label>
               <select id="presetSelector" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                   <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯JavaScriptã§å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
               </select>
           </div>

           <div class="flex flex-col sm:flex-row gap-4 justify-between">
               <!-- ä½éŸ³è¨­å®š -->
               <div class="w-full sm:w-1/2">
                   <label for="lowFreqInput" class="block text-sm font-medium text-gray-600 text-left mb-1">ä½éŸ³ï¼ˆãƒ”ãƒƒï¼‰</label>
                   <input type="number" id="lowFreqInput" value="600" min="20" max="20000" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-center" />
               </div>
               <!-- é«˜éŸ³è¨­å®š -->
               <div class="w-full sm:w-1/2">
                   <label for="highFreqInput" class="block text-sm font-medium text-gray-600 text-left mb-1">é«˜éŸ³ï¼ˆãƒãƒ¼ãƒ³ï¼‰</label>
                   <input type="number" id="highFreqInput" value="1800" min="20" max="20000" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-center" />
               </div>
           </div>
           <p class="text-xs text-gray-500 mt-2">â€» å‘¨æ³¢æ•°ã‚’æ‰‹å‹•ã§å¤‰æ›´ã™ã‚‹ã¨ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã¯ã€Œã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€ã«ãªã‚Šã¾ã™ã€‚</p>
       </div>

       <!-- ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
       <div id="timerDisplay" class="signal-display text-gray-300">
           00.00
       </div>

       <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
       <div id="message" class="h-8 text-lg font-medium text-blue-600 mb-8">
           æº–å‚™å®Œäº†
       </div>

       <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
       <button id="startButton" class="w-full py-3 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition duration-300">
           å†ç”Ÿé–‹å§‹
       </button>

       <p class="text-sm text-gray-500 mt-4">
           â€» é€£ç¶šå†ç”Ÿã•ã‚Œã¾ã™ã€‚ã€Œåœæ­¢ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã‹ã€ç”»é¢ã‚’é–‰ã˜ã‚‹ã¾ã§åœæ­¢ã—ã¾ã›ã‚“ã€‚
       </p>
       
       <!-- LINE å…±æœ‰ãƒœã‚¿ãƒ³ -->
       <a id="lineShareButton" href="#" target="_blank" class="line-share-button mt-6">
           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
               <path d="M12 0c6.627 0 12 5.373 12 12s-5.373 12-12 12S0 18.627 0 12 5.373 0 12 0zM7.5 7.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm9 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM12 11.25c-1.657 0-3 1.343-3 3v1.5h6v-1.5c0-1.657-1.343-3-3-3z"/>
           </svg>
           <span>LINEã§å‹ã ã¡ã«å…±æœ‰</span>
       </a>
   </div>

   <script>
       // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
       let audioContext;
       let startTime;
       let timerInterval = null; // nullã§åœæ­¢çŠ¶æ…‹ã‚’ç¤ºã™
       const cycleDuration = 5;  // 5ç§’ã‚µã‚¤ã‚¯ãƒ«
       
       // ã€é‡è¦ã€‘å…±æœ‰URLã®è¨­å®š
       // å¤–éƒ¨ã«ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€ã“ã®å€¤ã‚’å®Ÿéš›ã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
       const ACTUAL_URL =(https://ohnotakahiro1977-blip.github.io/time-signal-app/)
       const LINE_SHARE_URL = encodeURIComponent(ACTUAL_URL);
       const LINE_SHARE_TEXT = encodeURIComponent("ğŸš¨ æ¥½ã—ã„æ™‚å ±ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’è¦‹ã¤ã‘ãŸã‚ˆï¼20ç¨®é¡ä»¥ä¸Šã®éŸ³æºï¼ˆæœ¨é­šã€å‘¼ã³éˆ´ãªã©ï¼‰ã‚’é¸ã¹ã‚‹ã‚ˆã€‚è©¦ã—ã¦ã¿ã¦ï¼");

       // 22ç¨®é¡ã®éŸ³è‰²ãƒ—ãƒªã‚»ãƒƒãƒˆ
       const presets = [
           { name: 'æ¨™æº–é›»è©±æ™‚å ± (ã‚ªãƒªã‚¸ãƒŠãƒ«)', low: 600, high: 1800 }, // åˆæœŸå€¤
           { name: 'å¤ã„é›»è©±æ™‚å ± (ãƒ¬ãƒˆãƒ­)', low: 440, high: 880 },
           { name: 'ç¾ä»£ãƒ‡ã‚¸ã‚¿ãƒ« (ã‚¯ãƒªã‚¢)', low: 1500, high: 2500 },
           { name: 'æ·±ã„ä½éŸ³ (ãƒ‰ãƒ­ãƒ¼ãƒ³)', low: 200, high: 500 },
           { name: 'é«˜ã„é«˜éŸ³ (ã‚­ãƒ³ã‚­ãƒ³)', low: 3000, high: 5000 },
           { name: 'ãƒ”ã‚¢ãƒå’ŒéŸ³ (C4-G4)', low: 261, high: 392 },
           { name: 'è­¦å‘ŠéŸ³A (é«˜ã‚)', low: 880, high: 1320 },
           { name: 'è­¦å‘ŠéŸ³B (ä½ã‚)', low: 400, high: 1000 },
           { name: 'ãƒã‚¹ã‚¿ãƒ«ã‚¸ãƒ¼', low: 500, high: 1000 },
           { name: 'ã‚²ãƒ¼ãƒ ãƒœãƒ¼ã‚¤é¢¨', low: 800, high: 1600 },
           { name: 'ã‚¹ã‚¯ã‚¨ã‚¢æ³¢é¢¨', low: 700, high: 1400 },
           { name: 'ã‚µã‚¤ãƒ¬ãƒ³é¢¨', low: 900, high: 1100 },
           { name: 'ãƒ›ãƒ©ãƒ¼é¢¨', low: 100, high: 200 },
           { name: 'çŸ­ä¸‰åº¦ (æ‚²ã—ã„éŸ³)', low: 440, high: 523 },
           { name: 'å®Œå…¨äº”åº¦ (å®‰å®šéŸ³)', low: 440, high: 660 },
           { name: 'é›»å­éŸ³A', low: 1200, high: 2000 },
           { name: 'é›»å­éŸ³B', low: 1800, high: 3600 },
           { name: 'å®‡å®™èˆ¹', low: 400, high: 700 },
           { name: 'ã‚«ãƒã‚«ãƒéŸ³', low: 2000, high: 2000 }, // åŒã˜å‘¨æ³¢æ•°ã§å˜èª¿ãªéŸ³
           { name: 'å‘¼ã³éˆ´ (ãƒãƒ£ã‚¤ãƒ é¢¨)', low: 784, high: 988 }, // G5ã¨B5ã§æ˜ã‚‹ã„éŸ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
           { name: 'æœ¨é­š (ä½éŸ³ãƒ‘ãƒ¼ã‚«ãƒƒã‚·ãƒ§ãƒ³)', low: 150, high: 250 }, // æ·±ãéŸ¿ãéŸ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
           { name: 'ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º', low: 600, high: 1800 } // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰‹å‹•å…¥åŠ›ç”¨ (åˆæœŸå€¤)
       ];

       // DOMè¦ç´ 
       const startButton = document.getElementById('startButton');
       const timerDisplay = document.getElementById('timerDisplay');
       const messageDisplay = document.getElementById('message');
       const lowFreqInput = document.getElementById('lowFreqInput');
       const highFreqInput = document.getElementById('highFreqInput');
       const presetSelector = document.getElementById('presetSelector');
       const lineShareButton = document.getElementById('lineShareButton');

       /**
        * ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠè‚¢ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«è¿½åŠ ã™ã‚‹
        */
       function populatePresets() {
           presets.forEach((preset, index) => {
               const option = document.createElement('option');
               option.value = index;
               option.textContent = preset.name + ` (${preset.low}Hz / ${preset.high}Hz)`;
               if (index === 0) {
                   option.selected = true;
               }
               presetSelector.appendChild(option);
           });
       }

       /**
        * ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠæ™‚ã«å‘¨æ³¢æ•°å…¥åŠ›æ¬„ã‚’æ›´æ–°ã™ã‚‹
        */
       presetSelector.addEventListener('change', (event) => {
           const selectedIndex = parseInt(event.target.value, 10);
           const preset = presets[selectedIndex];
           if (preset) {
               lowFreqInput.value = preset.low;
               highFreqInput.value = preset.high;
           }
       });

       /**
        * æ‰‹å‹•ã§å‘¨æ³¢æ•°ã‚’å¤‰æ›´ã—ãŸéš›ã€ã€Œã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€ã«å¤‰æ›´ã™ã‚‹
        */
       function setCustomPreset() {
           const customIndex = presets.findIndex(p => p.name === 'ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º');
           if (presetSelector.value !== customIndex.toString()) {
                presetSelector.value = customIndex;
                // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã®ãƒ†ã‚­ã‚¹ãƒˆã‚‚ç¾åœ¨ã®å€¤ã«æ›´æ–°ã™ã‚‹
                const customOption = presetSelector.options[customIndex];
                if (customOption) {
                   customOption.textContent = `ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º (${lowFreqInput.value}Hz / ${highFreqInput.value}Hz)`;
                }
           }
       }

       lowFreqInput.addEventListener('input', setCustomPreset);
       highFreqInput.addEventListener('input', setCustomPreset);


       /**
        * æ™‚å ±ã®ã€Œãƒ”ãƒƒã€ã¾ãŸã¯ã€Œãƒãƒ¼ãƒ³ã€ã®éŸ³ã‚’åˆæˆã—ã¦å†ç”Ÿã™ã‚‹é–¢æ•°
        */
       function playSignal(frequency, duration, type) {
           if (!audioContext) return;

           // ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆéŸ³æºï¼‰ã‚’ä½œæˆ
           const oscillator = audioContext.createOscillator();
           oscillator.type = 'sine'; // ã‚µã‚¤ãƒ³æ³¢ã‚’ä½¿ç”¨
           
           // å‘¨æ³¢æ•°ã‚’è¨­å®š
           oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);

           // ã‚²ã‚¤ãƒ³ï¼ˆéŸ³é‡ï¼‰ãƒãƒ¼ãƒ‰ã‚’ä½œæˆ
           const gainNode = audioContext.createGain();
           
           // ã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—ï¼ˆéŸ³é‡å¤‰åŒ–ï¼‰ã‚’è¨­å®š
           const now = audioContext.currentTime;
           
           // éŸ³é‡ã‚’å¾ã€…ã«ä¸Šã’ï¼ˆã‚¢ã‚¿ãƒƒã‚¯ï¼‰ã€ä¿æŒã—ã€å¾ã€…ã«ä¸‹ã’ã‚‹ï¼ˆãƒªãƒªãƒ¼ã‚¹ï¼‰
           gainNode.gain.setValueAtTime(0, now); // åˆæœŸéŸ³é‡0
           
           // ã‚¢ã‚¿ãƒƒã‚¯ã‚¿ã‚¤ãƒ  (0.01ç§’ã§æœ€å¤§éŸ³é‡ã¸)
           gainNode.gain.linearRampToValueAtTime(0.5, now + 0.01);

           // ã‚µã‚¹ãƒ†ã‚£ãƒ³/ãƒ‡ã‚£ã‚±ã‚¤
           if (type === 'long') {
               // ã€Œãƒãƒ¼ãƒ³ã€ï¼ˆé«˜éŸ³ï¼‰ã®å ´åˆã¯é•·ã‚ã«éŸ³ã‚’ä¿æŒ
               gainNode.gain.setValueAtTime(0.5, now + duration - 0.1);
           }
           
           // ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚¤ãƒ  (çµ‚äº†ç›´å‰ã«éŸ³é‡ã‚’0ã¸)
           gainNode.gain.linearRampToValueAtTime(0, now + duration);

           // æ¥ç¶š: ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼ -> ã‚²ã‚¤ãƒ³ -> å‡ºåŠ›
           oscillator.connect(gainNode);
           gainNode.connect(audioContext.destination);

           // å†ç”Ÿé–‹å§‹ã¨åœæ­¢
           oscillator.start();
           oscillator.stop(now + duration);
       }
       
       /**
        * ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢ã—ã€è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
        */
       function stopTimer() {
           if (timerInterval) {
               clearInterval(timerInterval);
               timerInterval = null;
           }
           
           startButton.textContent = 'å†ç”Ÿé–‹å§‹';
           startButton.classList.replace('bg-red-600', 'bg-green-600');
           messageDisplay.textContent = 'åœæ­¢ã—ã¾ã—ãŸã€‚';
           timerDisplay.classList.remove('text-red-600', 'text-yellow-500', 'text-orange-500', 'text-blue-600', 'text-gray-600');
           timerDisplay.classList.add('text-gray-300');
           // è¡¨ç¤ºã‚’00.00ã«ãƒªã‚»ãƒƒãƒˆ
           timerDisplay.textContent = '00.00';
           
           if (audioContext && audioContext.state === 'running') {
               audioContext.suspend();
           }
       }


       /**
        * 5ç§’å‘¨æœŸã§æ™‚å ±ã®éŸ³ã‚’é³´ã‚‰ã™ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
        */
       function checkAndPlaySignal(currentElapsed) {
           // ç¾åœ¨è¨­å®šã•ã‚Œã¦ã„ã‚‹å‘¨æ³¢æ•°å€¤ã‚’èª­ã¿è¾¼ã‚€
           const lowFreq = parseInt(lowFreqInput.value, 10) || 600;
           const highFreq = parseInt(highFreqInput.value, 10) || 1800;

           // çµŒéæ™‚é–“ã‚’å°æ•°ç‚¹ä»¥ä¸‹2æ¡ã§è¡¨ç¤º
           const seconds = (currentElapsed % 60).toFixed(2);
           timerDisplay.textContent = seconds;
           
           // çµŒéæ™‚é–“ã‚’5ç§’å‘¨æœŸã®ã©ã“ã«ã„ã‚‹ã‹ã§è¦‹ã‚‹
           const modTime = currentElapsed % cycleDuration;
           
           // éŸ³ã‚’é³´ã‚‰ã™é–¾å€¤ (Â±0.02ç§’ã®ç¯„å›²)
           const threshold = 0.02;

           // --- 5ç§’ã‚µã‚¤ã‚¯ãƒ«ã®ãƒã‚§ãƒƒã‚¯ ---

           // 1. äºˆå‚™ä¿¡å· 1 (T-2, 5ç§’å‘¨æœŸã®3ç§’ç›®): ä½éŸ³
           if (modTime >= 3.0 - threshold && modTime < 3.0 + threshold) {
               playSignal(lowFreq, 0.1, 'short'); // ä½éŸ³
               timerDisplay.classList.remove('text-red-600', 'text-orange-500', 'text-blue-600');
               timerDisplay.classList.add('text-yellow-500');
               messageDisplay.textContent = `ãƒ”ãƒƒï¼ˆä½éŸ³ ${lowFreq}Hzãƒ»äºˆå‚™ä¿¡å·ï¼‰: ${currentElapsed.toFixed(1)}ç§’`;
               return;
           }
           
           // 2. äºˆå‚™ä¿¡å· 2 (T-1, 5ç§’å‘¨æœŸã®4ç§’ç›®): ä½éŸ³
           if (modTime >= 4.0 - threshold && modTime < 4.0 + threshold) {
               playSignal(lowFreq, 0.1, 'short'); // ä½éŸ³
               timerDisplay.classList.remove('text-red-600', 'text-yellow-500', 'text-blue-600');
               timerDisplay.classList.add('text-orange-500');
               messageDisplay.textContent = `ãƒ”ãƒƒï¼ˆä½éŸ³ ${lowFreq}Hzãƒ»äºˆå‚™ä¿¡å·ï¼‰: ${currentElapsed.toFixed(1)}ç§’`;
               return;
           }

           // 3. æ™‚åˆ»é€šçŸ¥ (T, 5ç§’å‘¨æœŸã®0ç§’ç›®): é«˜éŸ³
           // ãŸã ã—ã€0.0ç§’ï¼ˆé–‹å§‹æ™‚ï¼‰ã¯é™¤ã
           if (currentElapsed > 0.1 && modTime >= 0.0 - threshold && modTime < 0.0 + threshold) {
               playSignal(highFreq, 0.5, 'long'); // é«˜éŸ³
               timerDisplay.classList.remove('text-yellow-500', 'text-orange-500', 'text-blue-600');
               timerDisplay.classList.add('text-red-600');
               messageDisplay.textContent = `ãƒãƒ¼ãƒ³ï¼ï¼ˆé«˜éŸ³ ${highFreq}Hzãƒ»æ™‚åˆ»é€šçŸ¥ï¼‰: ${currentElapsed.toFixed(1)}ç§’`;
               return;
           }
           
           // --- é€šå¸¸è¡¨ç¤º ---
           // éŸ³ãŒé³´ã£ã¦ã„ãªã„ã¨ã
           if (timerInterval && !timerDisplay.classList.contains('text-blue-600')) {
               // éŸ³ãŒé³´ã‚Šçµ‚ã‚ã£ãŸã‚‰ã€é€šå¸¸ã®é’è‰²ã«æˆ»ã™ãŸã‚ã®ã‚¯ãƒ©ã‚¹ãƒªã‚»ãƒƒãƒˆãƒã‚§ãƒƒã‚¯
               const isSilentTime = modTime > 0.0 + threshold && modTime < 3.0 - threshold ||
                                   modTime > 3.0 + threshold && modTime < 4.0 - threshold ||
                                   modTime > 4.0 + threshold && modTime < 5.0 - threshold;

               if (isSilentTime) {
                    timerDisplay.classList.remove('text-red-600', 'text-yellow-500', 'text-orange-500', 'text-gray-300');
                    timerDisplay.classList.add('text-blue-600');
                    messageDisplay.textContent = 'é€£ç¶šå†ç”Ÿä¸­... 5ç§’é–“éš”ã§é€šçŸ¥ã—ã¾ã™ã€‚';
               }
           }
       }

       /**
        * ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹ã™ã‚‹é–¢æ•°
        */
       function startTimer() {
           // ã€ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã€‘AudioContextã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œï¼ˆã“ã®å ´åˆã¯ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼‰å¾Œã«ä½œæˆãƒ»å†é–‹
           if (!audioContext) {
               try {
                   audioContext = new (window.AudioContext || window.webkitAudioContext)();
               } catch (e) {
                   messageDisplay.textContent = 'ã‚¨ãƒ©ãƒ¼: Web Audio APIãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚';
                   return;
               }
           }

            // AudioContextãŒã‚µã‚¹ãƒšãƒ³ãƒ‰çŠ¶æ…‹ï¼ˆä¸€æ™‚åœæ­¢ä¸­ï¼‰ã§ã‚ã‚Œã°å†é–‹
           if (audioContext.state === 'suspended') {
               audioContext.resume();
           }

           startButton.textContent = 'åœæ­¢';
           startButton.classList.replace('bg-green-600', 'bg-red-600');
           timerDisplay.classList.remove('text-gray-300');
           timerDisplay.classList.add('text-gray-600');
           messageDisplay.textContent = 'é€£ç¶šå†ç”Ÿä¸­...';


           startTime = performance.now(); // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ²

           // 16ãƒŸãƒªç§’ï¼ˆç´„60fpsï¼‰ã”ã¨ã«æ›´æ–°
           timerInterval = setInterval(() => {
               const currentTime = performance.now();
               const elapsedSeconds = (currentTime - startTime) / 1000;

               // çµŒéæ™‚é–“ã«åŸºã¥ã„ã¦éŸ³ã‚’é³´ã‚‰ã™ã‹ãƒã‚§ãƒƒã‚¯
               checkAndPlaySignal(elapsedSeconds);
           }, 16);
       }

       /**
        * ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
        */
       startButton.addEventListener('click', () => {
           if (timerInterval) {
               // å†ç”Ÿä¸­ãªã‚‰åœæ­¢
               stopTimer();
           } else {
               // åœæ­¢ä¸­ãªã‚‰å†ç”Ÿé–‹å§‹
               startTimer();
           }
       });

       // --- åˆæœŸåŒ–å‡¦ç† ---
       populatePresets();
       messageDisplay.textContent = 'å‘¨æ³¢æ•°ã‚’è¨­å®šã€ã¾ãŸã¯ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’é¸æŠã—ã€ã€Œå†ç”Ÿé–‹å§‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚';
       // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã¯åœæ­¢çŠ¶æ…‹ã«è¨­å®š
       stopTimer();
       
       // LINEå…±æœ‰ãƒªãƒ³ã‚¯ã®è¨­å®š
       lineShareButton.href = `https://social-plugins.line.me/lineit/share?url=${LINE_SHARE_URL}&text=${LINE_SHARE_TEXT}`;

   </script>
</body>
</html>
